```yaml
---
# Proxmox VE 虚拟服务器系统初始化设置
- name: kvm
  hosts: all
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3
    basic_tools:
      - build-essential
      - python3-dev
      - python3-pip
      - cron
      - curl
      - git
      - htop
      - iftop
      - iptables
      - man
      - mosh
      - mtr-tiny
      - p7zip-full
      - tree
      - vim
      - vnstat
      - wget
      - zip

  pre_tasks:
    - raw: bash -c "test -e /usr/bin/python3 || (apt -qqy update && apt install -qqy python3)"

  tasks:
    - name: 设置为中国时区
      timezone: name='Asia/Shanghai'

    - name: 设置 bash 命令行提示符为彩色
      lineinfile: dest="~/.bashrc" regexp='^#?force_color_prompt=yes' line='force_color_prompt=yes'

    - name: vim 的自定义配置
      copy: content="syntax on" dest=/root/.vimrc force=yes backup=yes
    - lineinfile:
        path: "/root/.vimrc"
        line: "{{item}}"
      with_items:
        - syntax on
        - hi Comment ctermfg = 6
        - let loaded_matchparen=1
        - set encoding=utf-8
        - set tabstop=4
        - set softtabstop=4
        - set expandtab
        - set ruler
        - set showcmd
        - set showmatch
        - set hlsearch
        - set incsearch

    - name: 启用 ipv4 的转发，并禁用 ipv6
      copy: content="# Automatically generated by Ansible\n" dest=/etc/sysctl.conf force=yes backup=yes
    - lineinfile:
        path: "/etc/sysctl.conf"
        line: "{{item}}"
      with_items:
        - net.ipv4.ip_forward = 1
        - fs.file-max = 262144
        - vm.max_map_count = 262144
        - net.ipv6.conf.all.disable_ipv6 = 1
        - net.ipv6.conf.default.disable_ipv6 = 1
        - net.ipv6.conf.lo.disable_ipv6 = 1

    - name: 调整系统参数
      lineinfile:
        path: "/etc/security/limits.conf"
        line: "{{item}}"
      with_items:
        - "* soft nofile 262144"
        - "* hard nofile 262144"
        - "root soft nofile 262144"
        - "root hard nofile 262144"

    - name: 安装系统更新
      apt: upgrade=full update_cache=yes

    - name: 安装系统基础的应用工具
      apt: name={{basic_tools}} state=present

    - name: 卸载 snap step 1
      shell: "snap remove {{item}}"
      loop:
        - lxd
        - core20
        - snapd
      ignore_errors: yes
    - name: 卸载 snap step 2
      systemd: name=snapd state=stopped
      ignore_errors: yes
    - name: 卸载 snap step 3
      apt: name=snapd state=absent
    - name: 卸载 snap step 4
      file: path=/root/snap state=absent
```